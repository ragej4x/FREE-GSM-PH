{% extends 'base.html' %}
{% block content %}
  <script src="https://fpyf8.com/88/tag.min.js" data-zone="182873" async data-cfasync="false"></script>
  <script>(function(s){s.dataset.zone='10141996',s.src='https://al5sm.com/tag.min.js'})([document.documentElement, document.body].filter(Boolean).pop().appendChild(document.createElement('script')))</script>
  <script>(function(s){s.dataset.zone='10142003',s.src='https://forfrogadiertor.com/tag.min.js'})([document.documentElement, document.body].filter(Boolean).pop().appendChild(document.createElement('script')))</script>
  <div class="card" style="text-align:center; padding:32px;">
    <h2>Verifyingâ€¦</h2>
    <p class="hint">Please wait <span id="count">5</span>s while we verify your request.</p>
    <div style="margin:16px 0;">
      <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6120309864804101" crossorigin="anonymous"></script>
      <ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-6120309864804101" data-ad-slot="2778512087"></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </div>

    <div style="margin:16px 0;">
      <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6120309864804101" crossorigin="anonymous"></script>
      <!-- Normal -->
      <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6120309864804101" data-ad-slot="8088061976" data-ad-format="auto" data-full-width-responsive="true"></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </div>

    <div style="margin:16px 0;">
      <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6120309864804101" crossorigin="anonymous"></script>
      <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-6120309864804101" data-ad-slot="4526708024"></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </div>
  </div>

  <script>
    // Moving countdown + award credits with one-time token, then redirect
    const verifyToken = '{{ verify_token }}';
    if (!verifyToken) {
      // No token means invalid access - redirect immediately
      window.location.href = '/dashboard';
    } else {
      let remaining = 5;
      const el = document.getElementById('count');
      let claimed = false; // Prevent multiple claims
      const tick = setInterval(() => {
        remaining -= 1;
        if (el) el.textContent = String(remaining);
        if (remaining <= 0 && !claimed) {
          claimed = true;
          clearInterval(tick);
          (async () => {
            try {
              const res = await fetch('/api/claim_credits_wall', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'same-origin',
                body: JSON.stringify({ token: verifyToken })
              });
              const j = await res.json();
              if (!res.ok && j.error === 'daily_limit_reached') {
                el.textContent = 'Daily limit reached!';
                setTimeout(() => window.location.href = '/dashboard', 2000);
                return;
              }
            } catch(_) {}
            window.location.href = '/';
          })();
        }
      }, 1000);
    }
  </script>
{% endblock %}


